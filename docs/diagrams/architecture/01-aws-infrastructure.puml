@startuml AWS Architecture
!theme plain
skinparam linetype ortho

actor User as user

package "Frontend" {
    rectangle "CloudFront\nCDN" as cloudfront
    rectangle "S3 Bucket\nStatic Assets" as s3
}

package "Authentication" {
    rectangle "Cognito\nUser Pool + SSO" as cognito
}

package "API Layer" {
    rectangle "API Gateway\nREST API" as apigw
}

package "Compute" {
    rectangle "Projects API\nNode.js 24" as lambda1
    rectangle "Budget API\nNode.js 24" as lambda2
    rectangle "Time Entry API\nNode.js 24" as lambda3
    rectangle "Actuals API\nNode.js 24" as lambda4
    rectangle "Projections API\nNode.js 24" as lambda5
}

package "Data Layer" {
    rectangle "VPC\nPrivate Network" as vpc {
        database "Aurora Serverless v2\nPostgreSQL 16" as aurora
    }
}

package "Security" {
    rectangle "Secrets Manager\nDB Credentials" as secrets
}

package "Monitoring" {
    rectangle "CloudWatch\nLogs + Metrics" as cloudwatch
}

user --> cloudfront : HTTPS
cloudfront --> s3 : Fetch Assets
user --> apigw : API Calls
apigw --> cognito : Validate JWT
apigw --> lambda1
apigw --> lambda2
apigw --> lambda3
apigw --> lambda4
apigw --> lambda5

lambda1 --> secrets : Get Credentials
lambda2 --> secrets
lambda3 --> secrets
lambda4 --> secrets
lambda5 --> secrets

lambda1 --> aurora : Query
lambda2 --> aurora
lambda3 --> aurora
lambda4 --> aurora
lambda5 --> aurora

lambda1 --> cloudwatch : Logs
lambda2 --> cloudwatch
lambda3 --> cloudwatch
lambda4 --> cloudwatch
lambda5 --> cloudwatch

note right of cognito
  - Email/Password
  - Microsoft SSO
  - MFA (TOTP)
  - Groups: Admin, PM, Viewer
end note

note right of aurora
  - Scales 0.5-2 ACU
  - Private subnet
  - Encrypted at rest
  - 7-day backups
end note

note right of apigw
  - Cognito Authorizer
  - Rate limiting: 100 req/s
  - Request validation
  - CORS enabled
end note

@enduml
